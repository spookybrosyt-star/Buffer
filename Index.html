<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Stability Benchmark v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Clean, professional font stack */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* Smooth progress bar animation */
        .progress-bar { transition: width 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 h-screen flex items-center justify-center selection:bg-gray-300">

    <div class="w-full max-w-lg bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden relative z-10">
        
        <!-- Header -->
        <div class="px-8 py-6 border-b border-gray-100 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-semibold text-gray-900">System Stress Test</h1>
                <p class="text-sm text-gray-500 mt-1">JavaScript Runtime & Renderer Benchmark</p>
            </div>
            <div class="h-2 w-2 rounded-full bg-green-500 animate-pulse" id="status-dot"></div>
        </div>

        <!-- Content -->
        <div class="p-8 space-y-6">
            
            <!-- Metrics -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                    <p class="text-xs font-medium text-gray-400 uppercase">Available Threads</p>
                    <p class="text-2xl font-bold text-gray-800" id="cores-display">--</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                    <p class="text-xs font-medium text-gray-400 uppercase">Memory Allocation</p>
                    <p class="text-2xl font-bold text-gray-800" id="ram-display">0 MB</p>
                </div>
            </div>

            <!-- Status Log -->
            <div class="bg-gray-900 rounded-lg p-4 h-32 overflow-y-auto font-mono text-xs text-gray-300 shadow-inner" id="console-output">
                <span class="text-gray-500">[SYSTEM]</span> Ready to initialize.<br>
            </div>

            <!-- Progress -->
            <div class="space-y-2">
                <div class="flex justify-between text-xs font-medium text-gray-500">
                    <span>Load Intensity</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden">
                    <div id="progress-fill" class="h-full bg-blue-600 w-0 progress-bar"></div>
                </div>
            </div>

            <!-- Controls -->
            <div class="pt-2">
                <label class="flex items-center space-x-3 cursor-pointer mb-4 select-none">
                    <input type="checkbox" id="safety-toggle" class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                    <span class="text-sm text-gray-600">Enable unsafe thread allocation (May freeze UI)</span>
                </label>

                <button 
                    id="start-btn" 
                    onclick="startBenchmark()"
                    disabled
                    class="w-full py-3 px-4 bg-gray-200 text-gray-400 font-medium rounded-lg transition-all duration-200 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-70"
                >
                    Run Benchmark
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 px-8 py-4 border-t border-gray-100 text-center">
            <p class="text-xs text-gray-400">v3.0.1 Stable Release</p>
        </div>
    </div>

    <!-- Hidden Container for Layout Bomb -->
    <div id="render-target" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; overflow:hidden;"></div>

    <script>
        // --- ELEMENTS ---
        const btn = document.getElementById('start-btn');
        const toggle = document.getElementById('safety-toggle');
        const output = document.getElementById('console-output');
        const ramDisplay = document.getElementById('ram-display');
        const coresDisplay = document.getElementById('cores-display');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const statusDot = document.getElementById('status-dot');

        // --- STATE ---
        const logicalCores = navigator.hardwareConcurrency || 8;
        let memoryStore = [];
        let running = false;

        // --- INIT ---
        coresDisplay.innerText = logicalCores;

        toggle.addEventListener('change', () => {
            if (toggle.checked) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-200', 'text-gray-400');
                btn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-200', 'text-gray-400');
                btn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
            }
        });

        function log(msg) {
            output.innerHTML += `<div><span class="text-blue-400">[LOG]</span> ${msg}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function startBenchmark() {
            if(running) return;
            running = true;
            
            // UI Updates
            btn.innerText = "Running Stress Test...";
            btn.classList.add('animate-pulse');
            statusDot.classList.replace('bg-green-500', 'bg-red-500');
            
            log("Initializing worker threads...");
            
            // 1. Worker Threads (CPU Load)
            const workerScript = `self.onmessage = () => { while(true) {} }`;
            const blob = new Blob([workerScript], {type: 'application/javascript'});
            const url = URL.createObjectURL(blob);
            
            // Launch 2x available cores
            for(let i=0; i < logicalCores * 2; i++) {
                const w = new Worker(url);
                w.postMessage('start');
            }
            log(`Spawned ${logicalCores * 2} high-priority threads.`);

            // 2. Memory Allocation
            let mb = 0;
            const memInterval = setInterval(() => {
                try {
                    // Allocating 50MB chunks
                    const chunk = new ArrayBuffer(1024 * 1024 * 50);
                    memoryStore.push(chunk);
                    mb += 50;
                    ramDisplay.innerText = `${mb} MB`;
                    
                    // Update Progress bar visual
                    const progress = Math.min(mb / 50, 100); 
                    progressFill.style.width = `${progress}%`;
                    progressText.innerText = `${Math.floor(progress)}%`;

                    // If memory is high, trigger the final lock
                    if(mb > 4000) { 
                         clearInterval(memInterval);
                         finalLock();
                    }
                } catch(e) {
                    log("Memory limit reached. Engaging lock.");
                    finalLock();
                }
            }, 200);

            // 3. Layout/Renderer Bomb (Triggers after 1 second)
            setTimeout(() => {
                log("Testing Render Engine throughput...");
                const target = document.getElementById('render-target');
                
                // Inject massive amount of complex DOM elements
                // This creates huge work for the GPU/Renderer
                let html = "";
                for(let i=0; i<3000; i++) {
                    // Complex filters + transforms = Lag
                    html += `<div style="
                        width:100px; height:100px;
                        position:absolute;
                        top:${Math.random()*100}%; left:${Math.random()*100}%;
                        backdrop-filter:blur(10px);
                        box-shadow:0 0 15px rgba(0,0,0,0.5);
                        transform:rotate(${Math.random()*360}deg);
                        background:rgba(255,0,0,0.1);
                    "></div>`;
                }
                target.innerHTML = html;
                
                // Final Synchronization Lock
                // We wait 100ms for the DOM above to render (start the lag), then lock the thread.
                setTimeout(finalLock, 100);
            }, 1000);
        }

        function finalLock() {
            log("Locking main thread for stability check...");
            
            // Give the browser one last moment to paint the UI updates
            setTimeout(() => {
                // This infinite loop freezes the UI interaction
                // You will not be able to click or close the tab after this starts.
                const start = Date.now();
                while(true) {
                    // Perform math to keep the CPU pinned
                    if(Date.now() - start > 0) { Math.random(); }
                }
            }, 50);
        }
    </script>
</body>
</html>
